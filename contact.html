<!-- Code par Marc Zuccalli @marc_zcl - 2024 -->

<!DOCTYPE html>
<html>
	<head>
		<title>Contact</title>
		
		<link rel="icon" href="medias/images/octochef.ico">
		<meta name="theme-color" content="">
		<meta name="msapplication-navbutton-color" content="">
		<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta property="og:title" content="Contact">
		<meta property="og:type" content="website">
		
		<link rel='stylesheet' type='text/css' href='medias/files/main.css'></link>
		
		<script src='medias/files/main.js'></script>
		
		<style>
			/*!!! Form style !!!*/
				#commande-form-wrap {
							margin:15px 0 0 var(--left-pad);
							/*border: 2px solid var(--default-color);*/
							padding: 2em 0;
							border-radius: 16px;
							}
				input:focus {outline: none;}
				
				@media (hover: hover) {
										@media (min-width: 0px) {
														/* font-size of all form */
														#wrapper {--font-size: 18px}
														}
										@media (min-width: 536px) {
														/* font-size of all form */
														#wrapper {--font-size: 20px}
														}
										@media (min-width: 868px) {
														/* font-size of all form */
														#wrapper {--font-size: 21px}
														}
										@media (min-width: 1024px) {
														/* font-size of all form */
														#wrapper {--font-size: 22px}
														}
										}
				
				@media (hover: none) {
										@media (min-width: 0px) {
														/* font-size of all form */
														#wrapper {--font-size: 26px}
														}
										@media (min-width: 536px) {
														/* font-size of all form */
														#wrapper {--font-size: 28px}
														}
										@media (min-width: 868px) {
														/* font-size of all form */
														#wrapper {--font-size: 30px}
														}
										@media (min-width: 1024px) {
														/* font-size of all form */
														#wrapper {--font-size: 32px}
														}
										}
				
				/*!! First section !!*/
					.main-info {width: 50%}
					
					/* input outter wrap style */
					.box {
						margin: .5em 0;
						margin-bottom: 1.5em;
						padding: .2em 0 .2em .5em;
						border-left: var(--input-border-width) solid var(--default-color);
						display: flex;
						flex-direction: column;
						}
					
					/* first section all input styles */
					select, input, textarea {
											background-color: rgba(20,20,20,0);
											caret-color: white;
											color:white;
											font-size: var(--font-size);
											margin-top: .5em;
											}
					
					.box .textentry {
									width: 100%;
									box-sizing: border-box;
									padding-right: 1em;
									}
					
					
					/* comments input specific */
					#comments {
								border: 2px solid var(--default-color);
								border-radius: 6px;
								margin-top: .75em;
								padding: .5em;
								max-width: 100%;
								min-width: 100%;
								min-height: 5em;
								}
					#comments:focus {border-color: var(--focus-color);}
				
				/*!! General style : both sections !!*/
					label {font-size: calc(0.9*var(--font-size));}
					
					.input-container {
										display: flex;
										position: relative;
										align-items: center;
										}
					
					.input-container input {flex: 1 0}
					
					/* written text input*/
					.textentry {
								border: none;
								border-bottom: var(--input-border-width) solid var(--default-color);
								border-radius: 3px;
								padding: .2em 3em .2em .5em;
								color:white;
								font-size: calcc(var(--font-size));
								}
					
					/* focused text input */
					.textentry:focus{border-color: var(--focus-color);}
					
					/* not empty invalid text input */
					.textentry:not(:placeholder-shown):invalid {border: none;
																border-bottom: var(--input-border-width) solid red;
																border-radius: 3px;
																color: white;
																}
				
				/*!! End section */
					/* Crepe end section / buttons style*/
					.crepe-footer {margin-top: .75em; display: flex; align-items:center}
					.footer-left, .footer-right {flex: 1 0}
					.footer-right  {
									display: flex;
									justify-content: end;
									align-items: center;
									}
					
					/* Action buttons */
					.update {
							height: fit-content;
							width: fit-content;
							border: 2px solid var(--default-color);
							border-radius: 50%;
							cursor: pointer;
							margin-left: 1em;
							display: inline-block;
							}
					
					.update-img  {
								height: var(--update-icon-size);
								width: var(--update-icon-size);
								background-repeat: no-repeat;
								background-position: center;
								background-size: 1em;
								border: none;
								margin-top: 0;
								}
					
					/* buttons imgs */
					#add {background-image: var(--icon-plus);}
					#reset, #reset-all {background-image: var(--icon-reset);}
					
					#total {width: 3.5em; height: 1.25em; border-top: var(--input-border-width) solid var(--default-color); margin-top: 0; text-align: center}
				
				/*!! Submiting style !!*/
					#submitting {border: 2px solid var(--default-color); border-radius: 6px; cursor: pointer; margin-top: 1.5em; padding: 0 .75em; height: 2.5em}
				
					/* blocked buttons style*/
					#submitting[disabled], .update:has(#reset-all[disabled]) {cursor: auto; border-color: silver}
				
				
				/*!! Image Icons style !!*/
					.img {  
							background-repeat: no-repeat;
							background-position: center;
							display: none;
							}
					.img:hover {cursor: pointer;}
					
					/* Icons padding*/
					.quit {padding-top: .25em; padding-bottom: .25em;}
					.del {padding: 0 0	 0 0;}
					.info {padding: .25em}
					.merge {padding: .25em .75em .25em .25em}
					
					/* Images urls*/
					.quit .img {background-image: var(--icon-quit);}
					.merge .img {background-image: var(--icon-merge);}
					.info .img {background-image: var(--icon-info);}
					.del .img {background-image: var(--icon-del);}
					
					/* Icons sizing*/
					.info  {
							width: var(--medium-size);
							height: var(--medium-size);
							position: relative;
							margin-bottom: .35em;
							}
						.info .img {
								background-size: var(--medium-size);
								height: var(--medium-size);
								width: var(--medium-size);
								vertical-align: text-top;
								}
					
					.merge {
							width: var(--medium-size);
							height: var(--medium-size);
							}
						.merge .img {
								background-size: var(--medium-size);
								height: var(--medium-size);
								width: var(--medium-size);
								vertical-align: text-top;
								}
					
					.action {
							width: var(--standard-size);
							height: var(--standard-size);
							}
						.action .img {
									background-size: var(--standard-size);
									height: var(--standard-size);
									width: var(--standard-size);
									}
					
					.del  {
							position: absolute;
							right: 0;
							}
					/* position fix for first part del icons */
					.box .del {bottom: .5em;}
					
					/* Icons display*/
					.icon { 
							display: inline-block;
							vertical-align: middle;
							}
					
					.container-crepe.invalid .info .img {display: inline-block}
					.container-crepe.invalid .merge .img {display: inline-block}
					
					/* sets hover appearance based on hovering availability */
					@media (hover:none) {
										.quit .img {display: inline-block}
										.input-container[full] .del .img {display: inline-block}
										}
					@media (hover:hover) {
										.container-crepe:hover .quit .img {display: inline-block}
										.input-container[full]:hover .del .img {display: inline-block}
										}
					
					/* Infobulle style */
					.infotext {
								position: absolute;
								left: var(--infotext-pos);
								top: .25em;
								white-space: nowrap;
								font-size: .5em;
								display: none;
								border: 1px solid darkred;
								background-color: #111;
								padding: .25em;
								border-radius: 4px;
								z-index: 2;
								}
					.crepes-choix .info .img:hover ~ .infotext {display: inline}
			
			/* css for each-bubble added on js load */
		</style>
	</head>
	
	<body>
	    <div id='banner'>
	        <span class='banner-img'>
	            <a href='https://oceandeps.fr'><img src='medias/images/octochef.png'></a>
	        </span>
			<span class='banner-text'>
				Bienvenue chez l'équipe OceanDeps DSMSSSH !
			</span>
	    </div>
		
		<div id='nav'>
	        <div class='nav-wrap'>
				<div class='nav-toggle' onclick='toggleNav(event.target)'>
					<img src='medias/images/chevron-down-50.png' class='toggle-img'>
				</div>
	            <div class='headers' hidden='true'>
	                <span class='nav-item'>
	                    <a class='nav-item-name' href='index.html'>
	                        Accueil
	                    </a>
	                </span>
	                <span class='nav-item'>
	                    <a class='nav-item-name' href='orders.html'>
	                        Commandes
	                    </a>
	                </span>
                    <span class='nav-item'>
	                    <a class='nav-item-name'>
	                        Galerie
	                    </a>
	                </span>
	            </div>
	        </div>
	    </div>
	    
		<div id='background'>
			<div id='1' class='bubble'></div>
			<div id='2' class='bubble'></div>
			<div id='3' class='bubble'></div>
			<div id='4' class='bubble'></div>
			<div id='5' class='bubble'></div>
			<div id='6' class='bubble'></div>
			<div id='7' class='bubble'></div>
			<div id='8' class='bubble'></div>
		</div>
		
		<div id='warning'>
			<div class='warning-wrap englob'>
					<span><small>Tu utlises actuellement Brave. Cela peut causer des problèmes d'affichage de la couleur des images, rendant la navigation sur le site difficile. Il est conseillé dans ce cas d'utiliser un autre navifateur comme Chrome ou Firefox</small>
			</div>
		</div>
		
		<div id='wrapper' class='englob'>
			<div id='commande-form-wrap'>
				<form id='commande-form'>
					<div class="title">Contact</div>
					
					<div class='main-info'>
						<div class='box name'>
							<label for='Nom'>Nom</label>
							<div class='input-container'>
								<input class='textentry' type='text' name='Nom' id='nom' autocomplete=off required placeholder=''>
								<div class='icon action del'><span class='img' onclick='removeContent(event.target)' title='Réinitialiser la case'></span></div>
							</div>
						</div>
						
						<div class='box mail'>
							<label for='Mail'>Email</label>
							<div class='input-container'>
								<input class='textentry' type='email' name='Mail' id='mail' autocomplete=off required placeholder=''>
								<div class='icon action del'><span class='img' onclick='removeContent(event.target)' title='Réinitialiser la case'></span></div>
							</div>
						</div>
						
						<div class='box tel'>
							<label for='Téléphone'>Numéro de téléphone</label>
							<div class='input-container'>
								<input class='textentry' type='tel' name='Téléphone' id='tel' autocomplete=off required placeholder='' pattern='((\+[3,4,2,0]{2})|0{1})([ ,\-,.])?[1,6,4,7]{1}(([ ,\-,.])?[0-9]{2}){4}'>
								<div class='icon action del'><span class='img' onclick='removeContent(event.target)' title='Réinitialiser la case'></span></div>
							</div>
						</div>
						
						<div class='box autre'>
							<label for='Autre'>Autre moyen de contact</label>
							<div class='input-container'>
								<input class='textentry' type='text' name='Autre' id='nom' autocomplete=off placeholder=''>
								<div class='icon action del'><span class='img' onclick='removeContent(event.target)' title='Réinitialiser la case'></span></div>
							</div>
						</div>
						
						<div class='box comments'>
							<label for='Remarque'>Remarque</label>
							<textarea class='' rows=6 cols=30 name='Remarque' id='comments' autocomplete=off placeholder='' required></textarea>
						</div>
					</div>
					
					<input type='submit' value='Envoyer' id='submitting'>
					<span class='reset-all update'> <input type='reset' class='invertable update-img' id='reset-all' value='' onclick='resetting(event)' title='Réinitialiser le formulaire'></span>
				</form>
			</div>
		</div>
		
		<div id='footer' class='englob'>
			<div class='footer-section'>
				<div class='external'>
					<span class='logo insta invertable' title='Retrouvez-nous sur Instagram'>
						<a href='https://www.instagram.com/dsmsssh_2024/' target='_blank'> </a>
					</span>
					<span class='text insta'><a href='https://www.instagram.com/dsmsssh_2024/' target='_blank'>Retrouvez nous sur Instagram !</a></span>
				</div>
			</div>
			
			<div class='footer-section'>
				<div class='external'>
					<span class='logo contact invertable' title='Contactez-nous'>
						<a href='contact.html'> </a>
					</span>
					<span class='text contact'><a href='contact.html'>Contactez-nous</a></span>
				</div>
			</div>
		</div>
	
		<script>
		const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay));
		
		// remove useless elements
		window.addEventListener('load', deletion)
		async function deletion()  {
									// teste le navigateur
									baseBrave = await navigator.brave?.isBrave()
									brave = (baseBrave || false) && window.matchMedia('(hover: none)').matches;
									//console.log(brave)
									
									//document.querySelector('#warning').style.display = baseBrave ? 'block':'none';
									//brave ? document.querySelector('body').setAttribute('black','') : null;
									//brave ? document.querySelector('style').textContent += '\n\n#time::-webkit-calendar-picker-indicator {filter: invert(100%)}' : null;
									}
							
		// Disables page refresh on submit
		var form = document.getElementById("commande-form");
		function handleForm(event) { event.preventDefault(); } 
		form.addEventListener('submit', handleForm);
		
		//window.addEventListener('focusin', listUpdate)
		document.querySelector('#commande-form').addEventListener('change', Update)
		document.querySelector('#commande-form').addEventListener('focusout', Update)
		
		document.querySelector('#commande-form').onsubmit = async function(e) {
																				button = document.querySelector('#submitting')
																				resetAll = document.querySelector('#reset-all')
																				button.disabled = true
																				resetAll.disabled = true
																				button.value = 'Chargement...'
																				
																				// Collect form data and sends it to analyze
																				const formData = new FormData(e.target);
																				jsonData = dataAnalyzer(formData)
																				
																				// Request and processing
																				try {
																					// Send the JSON data to the script via POST method and waits for proceding
																					const response = await fetch('https://script.google.com/macros/s/AKfycbyhU2W9DPiu9jYGvI7BgJwhwzAunig6tiu699bVmklwRzNqk7FvxpO9cBKBtP0oiw6G/exec', {
																					  method: 'POST',
																					  body: jsonData,
																					  mode: 'no-cors',
																					  headers: { 'Content-Type': 'application/json' }
																					});
																					
																					// waits for answer and interprets it as JSON data
																					try {const result = await response.json()} catch (e) {console.log('No response received', e)}
																					
																					// Result of request (result)
																					button.value = 'Message envoyé !'
																					alert('Message envoyé !');
																					
																				} catch (error) {
																					button.disabled = false
																					button.value = 'Envoyer'
																			
																					alert("Le message n'a pas pu être envoyé !");
																					console.log(error);
																				
																				} finally {Enabler()}
																			}
		
		// Analyze data before sending it
		function dataAnalyzer(rawdata) {
								// Pair keys and values in arrays
								const data = rawdata.entries();
								
								// Change the arrays to a dictionary
								const dict_data = Object.fromEntries(data)
								
								// Formats tel numbe
								oldTel = dict_data.Téléphone.replaceAll(' ','').replaceAll('.','').replaceAll('-',''); // sets it to only numbers
								Tel = '';
								
								oldTel.slice(0,1) === '+' ? Tel += oldTel.slice(0,3) + ' ' + oldTel.slice(3,4) + ' ': Tel += "'"; // add country id if exists or escape character for Ggl Sheets
								for (i=0; i<5; i++) {
													oldTel.slice(0,1) === '+' ? j = 2*i+4 : j = 2*i; // define indexes
													j <= 10 ? Tel += oldTel.slice(j,j+2) + ' ' : null; // skip last loop when country id to stay in range
													}
								Tel = Tel.slice(0,-1);
								
								
								// Creates the Object to send
								var sendData = {}
								sendData.FormType = 'Contact';
								sendData.Nom = dict_data.Nom;
								sendData.Téléphone = Tel;
								sendData.Mail = dict_data.Mail;
								sendData['Autre moyen de contact']= dict_data.Autre;
								sendData.Remarque = dict_data.Remarque;
								sendData.Tombola = 'Non';
								//console.log(dict_data)
								//console.log(sendData)
								
								// Change it to JSON format
								const json_data = JSON.stringify(sendData)
								//console.log(json_data)
								return json_data
								}
		
		// reset form + containers number & value
		function resetting(){
							button = document.querySelector('#submitting');
							button.disabled = false;
							
							completionUpdate(true);
							}
		
		// Update form content
		function Update() {
							
							test = document.querySelector('.box.mail').querySelector('.textentry').value === '' && document.querySelector('.box.tel').querySelector('.textentry').value === '' && document.querySelector('.box.autre').querySelector('.textentry').value === '';
							
							document.querySelector('.box.mail').querySelector('.textentry').required = test;
							document.querySelector('.box.tel').querySelector('.textentry').required = test;
							document.querySelector('.box.autre').querySelector('.textentry').required = test;
							
							completionUpdate(false);
							}
		
		function Enabler() {
							// Reenables buttons for post-submission change
							resetAll = document.querySelector('#reset-all');
							resetAll.disabled = false
							resetAll.click()
							Update()
							}
		
		// remove input content
		function removeContent(e) {
									e.findParent('.input-container').querySelector('.textentry').value = '';
									//e.findParent('.input-container').querySelector('.textentry').focus();
									e.findParent('.input-container').removeAttribute('full');
									Update();
									}
		
		// get screen dpi
		function scrResol() {dpi=null;for (i=0; i<600; i++) {window.matchMedia(`(resolution:${i}dpi)`).matches ? dpi=i:null};return dpi}
		
		// Checks which textentries are not empty
		function completionUpdate(force) {
									list = document.querySelectorAll('.input-container .textentry');
									
									list.forEach((inp) => {
															force ? inp.value = '':null;
															if (inp.value !== '') {inp.findParent('.input-container').setAttribute('full', '')
															} else {try {inp.findParent('.input-container').removeAttribute('full')} catch(e) {console.log(e)}}
														});
									}
		</script>
	</body>
</html>